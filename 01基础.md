<a id="mulu">目录</a>
<a href="#mulu" class="back">回到目录</a>
<style>
    .back{width:40px;height:40px;display:inline-block;line-height:20px;font-size:20px;background-color:lightyellow;position: fixed;bottom:50px;right:50px;z-index:999;border:2px solid pink;opacity:0.3;transition:all 0.3s;color:green;}
    .back:hover{color:red;opacity:1}
    img{vertical-align:bottom;}
</style>

<!-- @import "[TOC]" {cmd="toc" depthFrom=3 depthTo=6 orderedList=false} -->

<!-- code_chunk_output -->

- [常用命令](#常用命令)
- [变量与赋值](#变量与赋值)
    - [赋值](#赋值)
    - [变量管理](#变量管理)
    - [运算](#运算)
- [基本数据类型](#基本数据类型)
    - [数字](#数字)
    - [逻辑符号(logical)](#逻辑符号logical)
    - [字符串(character)](#字符串character)
    - [vector](#vector)
      - [创建](#创建)
      - [数据类型转换](#数据类型转换)
      - [vectorisation](#vectorisation)
      - [合并、取值与替换](#合并-取值与替换)
      - [其它函数](#其它函数)
    - [matrix](#matrix)
      - [创建](#创建-1)
      - [取行列](#取行列)
      - [替换](#替换)
      - [vectorisation](#vectorisation-1)
      - [相关函数](#相关函数)
    - [array和list](#array和list)
    - [数据类型的探测](#数据类型的探测)
    - [特别值](#特别值)
- [其它常用函数](#其它常用函数)
    - [sample](#sample)
    - [which](#which)

<!-- /code_chunk_output -->

<!-- 打开侧边预览：f1->Markdown Preview Enhanced: open...
只有打开侧边预览时保存才自动更新目录 -->

### 常用命令
使用`#`或`##`注释，CTRL+shift+c注释/取消注释
`? 函数/对象等` 获得有关它们的帮助信息

### 变量与赋值
##### 赋值
- `=`：如`x = 1`
- `<-`：如`x <- 1`，常用
- `->`：如`1 -> x`，较少使用
- `assign`函数：如`assign("x", 1)`，较少使用
##### 变量管理
所有的变量都可以在rstudio右上角的environment的data和values中显示
也可以使用函数查看：
```
ls();  ## 显示当前环境下所有变量
rm(x); ## 删除x变量
rm(list=ls()); ## 删除当前环境下所有变量
```
##### 运算
`a ^ b`：a的b次方
`a %% b`：取模
`&`/`|`：与/或，当左右两侧有数字类型时，会先转成bool类型（0->FALSE 其它->TRUE），当有其它类型时会报错
数学函数：log, log2, log10, exp, sin, cos, tan, sqrt等
```
log(10)  # 以e为底
```
### 基本数据类型
最基本的数据类型：数字和字符串
更高级的数据类型：vector向量和matrix矩阵
##### 数字
- 整数(integer)`287`
- 小数/浮点数(double)`99.99`
- 科学计数法
  - `1e-3` == `0.001` 即`1*10^-3^`
  - `1e2` == `100` 即`1*10^2^`
##### 逻辑符号(logical)
- 真：`TRUE`或`T`
- 假：`FALSE`或`F`

注意：它们不能小写
可转换成数字类型：T->1 F->0
```
1 + TRUE  # 2
2 * FALSE  # 0
```
##### 字符串(character)
可以是任何字符的组合，由单引号或双引号包括
```
'a sentence' ## 单括号
"一个字符串" ## 双括号
```
##### vector
###### 创建
**只能包含单一数据类型**
使用`c(元素1,元素2,...)`创建
```
c(100, 20, 30) ## 整数 vector 
c("字符串", "数组","是我") ## 字符串 vector
c(TRUE, FALSE, TRUE, T, F) ## 逻辑 vector
```
还可以使用`a:b`创建包含[a,b]整数的vector
```
2:8  # 2 3 4 5 6 7 8
```
###### 数据类型转换
在定义数组时，如果输入的数值是混合的，那么某些基本数据类型会自动转换为其它类型，以保证数值类型的一致性
优先级为：
1. 逻辑类型 -> 数字类型
2. 逻辑类型 -> 字符串
3. 数字类型 -> 字符串

即`逻辑类型`->`数字`->`字符串`
###### vectorisation
即**数据自动循环使用**
```
x <- c(10,100,1000, 10000);
(y <- sqrt(x) * 4 + 10); ## 赋值的之后打印变量内容
[1]  22.64911  50.00000 136.49111 410.00000
```
这里对vector进行了数值运算，相当于循环遍历其中每个元素进行运算，结果保存到另一个vector中

---

两个vector间也可进行运算：
```
a <- c(10,100,1000, 10000)
b <- c(10,100)
a / b
[1]   1   1 100 100
```
即`a[1]/b[1]` `a[2]/b[2]` 
此时b中的元素已遍历完成，自动循环使用`a[3]/b[1]` `a[4]/b[2]`
结果保存到新vector中
```
c(1,5,4,3,6) <= c(3,5,2,1,9);
TRUE  TRUE FALSE FALSE  TRUE
```
每个元素依次比较，即左边第一个元素和右边第一个元素比，左边第二个元素和右边第二个元素比，...
```
c(4,6,5,7,10,9,4,15)
x < 7  # 每个元素依次和7比较
# TRUE  TRUE  TRUE FALSE FALSE FALSE  TRUE FALSE
```

---

若两个vector的个数不成整数倍关系，仍会按此规则计算，只是会报warning
```
c(10,100,1000, 10000) / c(10,100,1000);
Warning: longer object length is not a multiple of shorter object length
[1]    1    1    1 1000
```
即`a[1]/b[1]` `a[2]/b[2]` `a[3]/b[3]` `a[4]/b[1]`
###### 合并、取值与替换
直接用`c(a,b)`就可将ab合并，同时进行数据类型转换
```
a <- 1:3;
b <- LETTERS[1:3];
( ab <- c(a,b) );  # "1" "2" "3" "A" "B" "C"
```
```
a[ length(a) + 1] <- 666  # 在结尾处添加元素
```

---

**R中第一个元素索引为1**
```
a[1];  # 第一个元素
a[ c(1, 4, 5) ];  # 第1，4，5个元素
a[ 2:5 ];  # 第[2,5]个元素，注意两边都是闭区间
a[ length(ab) ]; # length函数表示取长度，这里是取最后一个元素
```
```
a <- c(1,2,3,4,5,6)
a[1];  # 1
a[ c(1, 4, 5) ];  # 1 4 5
a[ 2:5 ];  # 2 3 4 5
a[ length(ab) ]; # 6
```

---

替换值就是给取到的值重新赋值
```
a[1] <- 10;  # 替换单个值
a[c(2,3)] <- c("20", "30");  # 替换多个值
a[3:6] <- c("0","1")  # 也是循环使用，相当于↓
a[3:6] <- c("0","1","0","1")
a  # "10" "20" "0"  "1"  "0"  "1"
```
###### 其它函数
- names(a)：获取/改变 元素/行/列的名称
  ```
  v <- 1:10
  names( v ) <- letters[1:10]
  a  b  c  d  e  f  g  h  i  j 
  1  2  3  4  5  6  7  8  9 10 
  ```
- as.character(a)：将a中每个元素变为字符串类型
  ```
  ab <- c(1:3);
  ab  # 1 2 3
  names( ab ) <- as.character( ab ); #将ab的每个元素命名
  ab  # 即第一个元素命名为"1"，第二个命名为"2"
  1 2 3 
  1 2 3 
  ```
- rev(a)：逆序
- sort(a)：排序，返回排序后结果
- order(a)：排序，返回排序后结果的每个元素在原数组中的位置
  ```
  lts <- c("C" "D" "A" "E" "B")
  sort( lts );  # "A" "B" "C" "D" "E"
  order( lts );  # 3 5 1 2 4
  即排序后结果的第一个元素"A"在原数组中的索引为3,...
  ```
##### matrix
可看做是一种带有限制的二维数组，矩阵内的数值也必须是同一种类型，类型强制转换规则同vector
###### 创建
`matrix(data, nrow=1, ncol=1, byrow=FALSE, dimnames=NULL)`
- data：用于创建矩阵的数据，必须有，可以是vector或矩阵
- nrow：指定行数，是一个整数
- ncol：指定列数，是一个整数
- byrow：是否按行将数据转化为矩阵
- dimnames：指定矩阵的行名和列名，是一个list

例：
```
matrix( c(20, 30.1, 2, 45.8, 23, 14), nrow = 2, byrow = T );  # 按行进行转化，就是先填满一行再填下一行
     [,1] [,2] [,3]
[1,] 20.0 30.1    2
[2,] 45.8 23.0   14
```
```
matrix( c(20, 30.1, 2, 45.8, 23, 14), nrow = 2, byrow = F );
     [,1] [,2] [,3]
[1,] 20.0  2.0   23
[2,] 30.1 45.8   14
```
```
matrix( c(20, 30.1, 2, 45.8, 23, 14), nrow = 2, 
       dimnames = list( c("row_A", "row_B"), c("A", "B", "C") ) );

         A    B  C
row_A 20.0  2.0 23
row_B 30.1 45.8 14
```
同时指定 ncol 和 nrow 时，生成的矩阵长度为nrow × ncol，此时可以不同于输入数据的长度。矩阵长度较小时，输入数据会被截短；而矩阵长度较大时，输入数据则会被重复使用。
```
## 生成一个2x5长度为10的矩阵，但输入数据的长度为20
matrix( 1:20, nrow = 2, ncol = 5, byrow = T); 
    [,1] [,2] [,3] [,4] [,5]
[1,]   1    2    3    4    5
[2,]   6    7    8    9   10
```
```
## 生成一个2x3长度为6的矩阵，但输入数据长度只有3
matrix( 1:3, nrow = 2, ncol = 3, byrow = T ); 
     [,1] [,2] [,3]
[1,]    1    2    3
[2,]    1    2    3
```
当矩阵长度大于输入数据长度，且前者不是后者的整数倍时，会报warning
```
matrix( 1:3, nrow = 2, ncol = 4, byrow = T );
Warning: data length [3] is not a sub-multiple or multiple of the number of rows [2]
     [,1] [,2] [,3] [,4]
[1,]    1    2    3    1
[2,]    2    3    1    2
```
矩阵长度小于输入数据的长度，且后者不是前者的整数倍时，也会报warning、
```
matrix( letters[1:20], nrow = 3, ncol = 5, byrow = T );  # letters[1:20]就是前20个小写字母
Warning: data length [20] is not a sub-multiple or multiple of the number of rows [3]
     [,1] [,2] [,3] [,4] [,5]
[1,] "a"  "b"  "c"  "d"  "e" 
[2,] "f"  "g"  "h"  "i"  "j" 
[3,] "k"  "l"  "m"  "n"  "o" 
```
###### 取行列
```
         A    B  C
row_A 20.0  2.0 23
row_B 30.1 45.8 14
```
`m[行索引,列索引]`其中行/列索引可以是单个整数，也可以是多个整数组成的vector。如果想单独取行/列，直接将列/行索引省略不写即可
```
m[ 1 , ];  # 取一行/一列的结果都是vector
 A  B  C 
20  2 23 
```
```
m[ 1:2,  ];
         A    B  C
row_A 20.0  2.0 23
row_B 30.1 45.8 14
```
```
m[ , 1 ];
row_A row_B 
 20.0  30.1
```
```
m[, c(1,2)];
         A    B
row_A 20.0  2.0
row_B 30.1 45.8
```
```
m[1:2, 2:3];  # 取其中一部分
         B  C
row_A  2.0 23
row_B 45.8 14
```

---

`m[行名,列名]`可以根据矩阵创建时指定的行/列名取到对应行/列
```
         A    B  C
row_A 20.0  2.0 23
row_B 30.1 45.8 14
```
```
m[ "row_A", ]
 A  B  C 
20  2 23 
```
```
m[ c( "row_B", "row_A" ), ]  # 注意取的顺序，先取了row_B，所以结果中row_B是第一行
         A    B  C
row_B 30.1 45.8 14
row_A 20.0  2.0 23
```
```
m[, c("B","A")];  # 注意取的顺序，先取了B列，所以结果中B是第一列
         B    A
row_A  2.0 20.0
row_B 45.8 30.1
```
###### 替换
直接给取到的行列赋值即可
```
         A    B  C
row_A 20.0  2.0 23
row_B 30.1 45.8 14
```
```
m[1, ] <- c(10);  # 替换一行，这里使用了vector的自动循环特性，将第一行的所有值置为10
         A    B  C
row_A 10.0 10.0 10
row_B 30.1 45.8 14
```
```
m[, "C"] <- c(230, 140);  # 替换一列
         A    B   C
row_A 10.0 10.0 230
row_B 30.1 45.8 140
```
```
m[ 1:2 , ] <- matrix( 1:6, nrow = 2 );  # 替换前两行
      A B C
row_A 1 3 5
row_B 2 4 6
```
```
m[ , c("C", "B") ] <- matrix( 100:103, nrow = 2 );  # 替换其中两列
      A   B   C
row_A 1 102 100
row_B 2 103 101
```
```
m[ 1  , c("C", "B") ] <- matrix(  110:111, nrow = 1 );  # 替换第一行的C/B列，注意取列的顺序，C->110、B->111
      A   B   C
row_A 1 111 110
row_B 2 103 101
```
###### vectorisation
与[vector中的vectorisation](#vectorisation)一样，都是数据的自动循环使用
```
m <- matrix( c(1, 2, 3, 4, 5, 6), nrow = 2, 
       dimnames = list( c("row_A", "row_B"), c("A", "B", "C") ) );
m
      A B C
row_A 1 3 5
row_B 2 4 6
```
```
m / c(1,10);
        A   B   C
row_A 1.0 3.0 5.0
row_B 0.2 0.4 0.6
```
计算时将矩阵展开成vector`c(1, 2, 3, 4, 5, 6)`（就是创建时使用的vector），将每个元素计算后（即`c(1, 2, 3, 4, 5, 6)/c(1,10)`），按列（创建时指定）填值
```
m / c(1,10,100)
        A    B    C
row_A 1.0 0.03 0.50
row_B 0.2 4.00 0.06
```
即`c(1, 2, 3, 4, 5, 6)/c(1,10,100)`
```
m / c(1,10,100,1000); ## 多于列数
Warning: longer object length is not a multiple of shorter object length
        A     B   C
row_A 1.0 0.030 5.0
row_B 0.2 0.004 0.6
```
即`c(1, 2, 3, 4, 5, 6)/c(1,10,100,1000)`
###### 相关函数
```
m
      A B C
row_A 1 3 5
row_B 2 4 6
```
- `dim(m)`：矩阵各维度长度
- `nrow(m)`：行数
- `ncol(m)`：列数
- `range(m)`：元素最大最小值
- `summary(m)`：（各列）元素最值、平均值、中位数、4等分点
- `t(m)`：转置

```
dim( m );  # 2 3
nrow( m );  # 2
ncol( m );  # 3
range( m );  # 1 6
summary( m );
      A              B              C       
Min.   :1.00   Min.   :3.00   Min.   :5.00  
1st Qu.:1.25   1st Qu.:3.25   1st Qu.:5.25  
Median :1.50   Median :3.50   Median :5.50  
Mean   :1.50   Mean   :3.50   Mean   :5.50  
3rd Qu.:1.75   3rd Qu.:3.75   3rd Qu.:5.75  
Max.   :2.00   Max.   :4.00   Max.   :6.00  
t(m);
  row_A row_B
A     1     2
B     3     4
C     5     6
```
##### array和list
高维数组可以由函数`array()`定义
```
array( data = LETTERS[1:16], 
      dim  = c(2,4,2),  # 指定维数，这里共有3维，长度分别为2、4、2
      dimnames = list( c("A","B"), 
                      c("one","two","three","four"), 
                      c("一", "二") ));
```
```
, , 一

  one two three four
A "A" "C" "E"   "G" 
B "B" "D" "F"   "H" 

, , 二

  one two three four
A "I" "K" "M"   "O" 
B "J" "L" "N"   "P" 
```
---

##### 数据类型的探测
数据类型汇总：
![数据类型汇总](./md-image/数据类型汇总.png){:width=250 height=250}
**r里面所有对象/数值都是一个vector**，如某个数字/bool值也是vector，这个vector只有一个元素
- `length()` 显示数据对象中元素/成分的数量
- `dim()` 获取数据对象的维度
- `str()` 显示数据对象的结构
- `mode()` 显示数据对象的类型，如：数值型、字符型、逻辑型等
- `class()` 显示数据对象的类或类型，如：矩阵、列表、数据框等
- `typeof()` 显示更细分的类
```
x = c(1,2,3);
length(x);  # 3
dim(x);  # NULL
str(x);  # num [1:3] 1 2 3
mode(x);  # "numeric"
class(x);  # "numeric"
typeof(x);  # "double"
```
```
x = matrix(c(1,2,3,4),nrow = 2);
length(x);  # 4
dim(x);  # 2 2 即每维的长度分别为2、2
str(x);  # num [1:2, 1:2] 1 2 3 4
mode(x);  # "numeric"
class(x);  # "matrix" "array"
typeof(x);  # "double"
```
##### 特别值
- `NULL`：空值，是特别值也是特别数据类型。
  ```
  typeof(NULL);  # "NULL"
  ```
- `na`：即not available，无法获得的值
- `Inf`/`-Inf`：正/负无穷，它们都属于`Inf`特别数据类型
- `nan`：不是数字，是`na`的一种
  ```
  c(-1, 0, 1) / 0;
  -Inf  NaN  Inf
  ```

---

判定特别值：
![判定特别值](./md-image/判定特别值.png){:width=250 height=250}
```
is.null( NULL );  # TRUE
is.numeric( NA );  # FALSE
is.numeric( Inf );  # TRUE
```

---

其它`is.`系列函数：
- `is.list()`
- `is.logical()`
- `is.character()`
- `is.vector()`
- ...
- `isTRUE()`：只在参数是一个逻辑运算值true时才返回true
  ```
  isTRUE( 5 )  # F
  isTRUE( 5 & 6 )  # T
  ```
### 其它常用函数
##### sample
sample(x,size,replace = FALSE)：从x数据中随机取样size个，返回一个vector
- replace：默认FALSE，即抽样数size不能大于x；若为TRUE，size可以大于x

```
sample(1:1000,3)  # 取3个在1-1000之间的随机数值
```
##### which
`which(m)`：which接收一个vector（可迭代对象），返回vector中所有为T的值的索引，结果为一个vector
```
x <- c(12:4)
y <- c(0,1,2,0,1,2,0,1,2)
is.finite(x/y)
# FALSE  TRUE  TRUE FALSE  TRUE  TRUE FALSE  TRUE  TRUE
which(!is.finite(x/y))
# 1 4 7
```
`!is.finite(x/y)`当x/y为无限数字时为true，`x/y=c(12/0,11,5,9/0,8,3.5,6/0,5,2)`，其中`12/0` `9/0` `6/0`的值为Inf，满足条件，索引分别为1，4，7
例：取出`a <- sample( 1:50, 20 )`中数据大于20的成员
```
a[which(a>20)]
```